<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Project NOVA — All-in-One Build Portal (Massive Single File)</title>
<meta name="description" content="Project NOVA — Complete codebase and docs embedded in single HTML for copy/paste. ROS2 nodes, firmware, Docker, models, BOM, wiring, training scripts and more." />
<style>
/* ---------- THEME & LAYOUT (long, comprehensive CSS) ---------- */
:root{
  --bg-1:#071426; --bg-2:#081a2d; --card:#071827; --muted:#9fb0c9;
  --accent:#6ee7b7; --accent-2:#7c3aed; --glass:rgba(255,255,255,0.02);
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
  --sans: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-1) 0%, var(--bg-2) 100%); color:#e6eef6;font-family:var(--sans);font-size:15px;line-height:1.45;}
.container{max-width:1280px;margin:18px auto;padding:22px;}
.header{display:flex;gap:18px;align-items:center;}
.logo{width:96px;height:96px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:900;color:#022; font-size:26px;box-shadow:0 20px 60px rgba(0,0,0,0.6);}
.title h1{margin:0;font-size:30px;}
.subtitle{color:var(--muted);margin-top:8px;}
.top-actions{margin-left:auto;display:flex;gap:10px;}
.btn{background:var(--glass);padding:8px 12px;border-radius:10px;color:var(--muted);text-decoration:none;border:1px solid rgba(255,255,255,0.03);cursor:pointer;font-weight:700;}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#042; border:none;}
.main{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:20px;}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 40px rgba(2,6,23,0.6);}
.section-title{display:flex;align-items:center;gap:12px;}
.huge{font-size:20px;font-weight:800}
.small-muted{color:var(--muted);font-size:13px}
.code-box{background:rgba(0,0,0,0.45);padding:12px;border-radius:8px;overflow:auto;border:1px solid rgba(255,255,255,0.03);font-family:var(--mono);font-size:13px;color:#dfffe6}
pre{margin:0;font-family:var(--mono);font-size:13px;color:#dbeffd}
table{width:100%;border-collapse:collapse;color:#dbeafe;margin-top:8px}
th,td{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left}
aside .card{position:sticky;top:28px}
.hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.02),transparent);margin:16px 0;border-radius:2px}
.footer{color:var(--muted);font-size:13px;text-align:center;margin-top:18px}
kbd{background:rgba(255,255,255,0.03);padding:4px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.02);font-family:var(--mono)}
/* responsive */
@media (max-width:1000px){.main{grid-template-columns:1fr}.logo{width:72px;height:72px;font-size:20px}}
/* long CSS extras (for UI richness) */
.nav-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.tab{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
.tab.active{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#052026}
.preview{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:8px;padding:10px;border:1px solid rgba(255,255,255,0.02);height:320px;overflow:auto}
.badge{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);color:var(--muted);font-weight:700}
</style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">NOVA</div>
      <div class="title">
        <h1>Project NOVA — All-in-One Build Portal</h1>
        <div class="subtitle">Embedded code, firmware, ROS2 packages, training scripts, wiring, BOM, and docs. Save as <strong>index.html</strong>.</div>
      </div>
      <div class="top-actions">
        <button class="btn btn-primary" id="download-all">Download ZIP (generate)</button>
        <a class="btn" href="https://github.com/SiddhardhaDev/Project-NOVA" target="_blank">Repo</a>
      </div>
    </header>

    <div class="main">
      <main>
        <section class="card">
          <div class="section-title"><div class="huge">Contents included</div><div class="small-muted">Large single-file snapshot of a complete starter codebase</div></div>
          <div class="hr"></div>
          <ul>
            <li>ROS2 workspace skeleton (packages: nova_bringup, nova_base, nova_vision, nova_voice, nova_task, nova_msgs)</li>
            <li>STM32 firmware for motor control and safety (C / HAL)</li>
            <li>Jetson-friendly Dockerfile + start scripts</li>
            <li>YOLOv8 training & deployment scripts + dataset manifest</li>
            <li>PaddleOCR integration script</li>
            <li>Detailed BOM CSV (long list) and procurement notes</li>
            <li>Inline wiring SVG schematic (high level)</li>
            <li>Sample UI pages and interactive JS (control panel simulation)</li>
            <li>Long README & troubleshooting checklist</li>
          </ul>
          <div class="hr"></div>

          <h3>Top-level project file tree (embedded)</h3>
          <pre class="code-box">
/Project-NOVA
├─ README.md
├─ docs/
├─ ros2_ws/
│  ├─ src/
│  │  ├─ nova_msgs/
│  │  ├─ nova_bringup/
│  │  ├─ nova_base/
│  │  ├─ nova_vision/
│  │  ├─ nova_task/
│  │  └─ nova_voice/
│  └─ install/ build/
├─ firmware/
│  └─ stm32/
├─ hardware/
│  ├─ cad/
│  └─ wiring/
├─ docker/
└─ assets/
          </pre>

          <div class="hr"></div>

          <h3 id="ros2-skeleton">ROS2 Workspace — skeleton (long)</h3>
          <p class="small-muted">Drop these files inside <code>ros2_ws/src/</code> and run <code>colcon build</code>. This section contains lengthy, complete files for quick copy/paste.</p>

          <h4>1) nova_msgs — custom messages</h4>
          <pre class="code-box">
# File: ros2_ws/src/nova_msgs/package.xml
<?xml version="1.0"?>
<package format="3">
  <name>nova_msgs</name>
  <version>0.0.1</version>
  <description>Custom messages for Project NOVA</description>
  <maintainer email="you@example.com">Siddhardha</maintainer>
  <license>Apache-2.0</license>
  <buildtool_depend>ament_cmake</buildtool_depend>
  <build_depend>rosidl_default_generators</build_depend>
  <exec_depend>rosidl_runtime_py</exec_depend>
</package>
          </pre>

          <pre class="code-box">
# File: ros2_ws/src/nova_msgs/msg/Detection.msg
string class_name
float32 x
float32 y
float32 w
float32 h
float32 conf
int32 frame_id
---
# File: ros2_ws/src/nova_msgs/msg/Detections.msg
nova_msgs/Detection[] detections
          </pre>

          <h4>2) nova_bringup — launch & params (very long)</h4>
          <pre class="code-box">
# File: ros2_ws/src/nova_bringup/package.xml
<?xml version="1.0"?>
<package format="3">
  <name>nova_bringup</name>
  <version>0.0.1</version>
  <description>Bringup files and launch configurations for NOVA</description>
  <maintainer email="you@example.com">Siddhardha</maintainer>
  <license>Apache-2.0</license>
  <buildtool_depend>ament_cmake</buildtool_depend>
  <exec_depend>rclpy</exec_depend>
</package>
          </pre>

          <pre class="code-box">
# File: ros2_ws/src/nova_bringup/launch/nova_bringup.launch.py
from launch import LaunchDescription
from launch_ros.actions import Node
from launch.actions import IncludeLaunchDescription
from launch.launch_description_sources import PythonLaunchDescriptionSource
import os

def generate_launch_description():
    pkg_share = os.path.join(os.getcwd(), 'install', 'nova_bringup', 'share', 'nova_bringup')
    return LaunchDescription([
        Node(package='robot_state_publisher', executable='robot_state_publisher', output='screen'),
        Node(package='nova_base', executable='base_node.py', name='nova_base', output='screen'),
        Node(package='nova_vision', executable='yolo_node.py', name='nova_vision', output='screen'),
        Node(package='nova_vision', executable='ocr_node.py', name='nova_ocr', output='screen'),
        Node(package='nova_task', executable='task_node.py', name='nova_task', output='screen'),
        Node(package='nova_voice', executable='tts_node.py', name='nova_tts', output='screen'),
    ])
</pre>

          <h4>3) nova_base — controller & odom (long Python node)</h4>
          <pre class="code-box">
# File: ros2_ws/src/nova_base/setup.py
from setuptools import setup

package_name = 'nova_base'

setup(
    name=package_name,
    version='0.0.1',
    packages=[package_name],
    py_modules=[],
    install_requires=['setuptools'],
    zip_safe=True,
    maintainer='You',
    maintainer_email='you@example.com',
    description='Base controller for NOVA',
    license='Apache-2.0',
    entry_points={
        'console_scripts': [
            'base_node = nova_base.base_node:main',
        ],
    },
)
</pre>

          <pre class="code-box">
# File: ros2_ws/src/nova_base/nova_base/base_node.py
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import Twist, PoseStamped
from nav_msgs.msg import Odometry
from std_msgs.msg import String, Bool, Float32
import serial
import time
import threading
import json
import os

class BaseNode(Node):
    def __init__(self):
        super().__init__('nova_base')
        self.declare_parameter('serial_port', '/dev/ttyACM0')
        self.declare_parameter('baudrate', 115200)
        self.port = self.get_parameter('serial_port').value
        self.baud = self.get_parameter('baudrate').value
        self.get_logger().info(f'Opening serial port: {self.port} @ {self.baud}')
        try:
            self.ser = serial.Serial(self.port, self.baud, timeout=0.05)
        except Exception as e:
            self.get_logger().error(f'Cannot open serial {self.port}: {e}')
            self.ser = None
        self.cmd_sub = self.create_subscription(Twist, '/cmd_vel', self.cb_cmd, 10)
        self.odom_pub = self.create_publisher(Odometry, '/odom', 10)
        self.status_pub = self.create_publisher(String, '/base/status', 10)
        self.timer = self.create_timer(0.05, self.timer_cb)
        self.last_cmd = Twist()
        self.lock = threading.Lock()
        self.encoder_l = 0
        self.encoder_r = 0
        self.wheel_base = 0.45
        self.wheel_radius = 0.09
        self.seq = 0
        self.start_time = self.get_clock().now()

    def cb_cmd(self, msg: Twist):
        with self.lock:
            self.last_cmd = msg
            # convert to motor velocity command (example scaling)
            v = msg.linear.x
            w = msg.angular.z
            left = v - (w * self.wheel_base / 2.0)
            right = v + (w * self.wheel_base / 2.0)
            # send to serial
            self.send_drive_command(left, right)

    def send_drive_command(self, left, right):
        if not self.ser:
            return
        try:
            cmd = f"VEL {left:.3f} {right:.3f}\\n".encode('utf-8')
            self.ser.write(cmd)
        except Exception as e:
            self.get_logger().error(f'Failed to send drive command: {e}')

    def timer_cb(self):
        # read serial for encoder/heartbeat
        if self.ser and self.ser.in_waiting:
            try:
                line = self.ser.readline().decode('utf-8').strip()
                if line:
                    self.handle_serial_line(line)
            except Exception as e:
                self.get_logger().error(f'Serial read error: {e}')
        # publish heartbeat status
        st = String()
        st.data = 'ok'
        self.status_pub.publish(st)

    def handle_serial_line(self, line):
        # expected JSON: {"enc_l":1234,"enc_r":5678,"bat_v":24.2}
        try:
            data = json.loads(line)
            self.encoder_l = data.get('enc_l', self.encoder_l)
            self.encoder_r = data.get('enc_r', self.encoder_r)
            # build odom
            odom = Odometry()
            odom.header.stamp = self.get_clock().now().to_msg()
            odom.header.frame_id = 'odom'
            odom.child_frame_id = 'base_link'
            # TODO: compute pose integration from encoders
            self.odom_pub.publish(odom)
        except Exception as e:
            # non-json line, just log
            self.get_logger().debug(f'non-json serial: {line}')

def main(args=None):
    rclpy.init(args=args)
    node = BaseNode()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.get_logger().info('Shutting down base node')
        node.destroy_node()
        rclpy.shutdown()
</pre>

          <h4>4) nova_vision — YOLOv8 + OCR (long Python scripts)</h4>
          <pre class="code-box">
# File: ros2_ws/src/nova_vision/setup.py
from setuptools import setup

package_name = 'nova_vision'

setup(
    name=package_name,
    version='0.0.1',
    packages=[package_name],
    install_requires=['setuptools'],
    zip_safe=True,
    maintainer='You',
    maintainer_email='you@example.com',
    description='Vision nodes for NOVA',
    license='Apache-2.0',
    entry_points={
        'console_scripts': [
            'yolo_node = nova_vision.yolo_node:main',
            'ocr_node = nova_vision.ocr_node:main',
        ],
    },
)
</pre>

          <pre class="code-box">
# File: ros2_ws/src/nova_vision/nova_vision/yolo_node.py
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from sensor_msgs.msg import Image
from cv_bridge import CvBridge
from nova_msgs.msg import Detections, Detection
import numpy as np
import cv2
import time
from ultralytics import YOLO
import os

class YoloNode(Node):
    def __init__(self):
        super().__init__('yolo_node')
        self.bridge = CvBridge()
        self.sub = self.create_subscription(Image, '/camera/color/image_raw', self.cb, 5)
        self.pub = self.create_publisher(Detections, '/detections', 5)
        model_path = os.environ.get('NOVA_YOLO_WEIGHTS', 'yolov8n.pt')
        self.get_logger().info(f'Loading YOLO model: {model_path}')
        try:
            self.model = YOLO(model_path)
        except Exception as e:
            self.get_logger().error(f'Failed to load YOLO: {e}')
            self.model = None

    def cb(self, msg: Image):
        if self.model is None:
            return
        img = self.bridge.imgmsg_to_cv2(msg, desired_encoding='bgr8')
        results = self.model(img, device='cuda:0', imgsz=640, conf=0.35)
        dets = Detections()
        for r in results:
            boxes = r.boxes
            for b in boxes:
                cls = int(b.cls[0])
                name = self.model.names[cls]
                x1,y1,x2,y2 = map(int, b.xyxy[0].tolist())
                w = x2-x1; h = y2-y1
                d = Detection()
                d.class_name = str(name)
                d.x = float(x1); d.y=float(y1); d.w=float(w); d.h=float(h)
                d.conf = float(b.conf[0])
                dets.detections.append(d)
        self.pub.publish(dets)

def main(args=None):
    rclpy.init(args=args)
    node = YoloNode()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()
</pre>

          <pre class="code-box">
# File: ros2_ws/src/nova_vision/nova_vision/ocr_node.py
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from sensor_msgs.msg import Image
from cv_bridge import CvBridge
from paddleocr import PaddleOCR
from std_msgs.msg import String
import numpy as np
import cv2

class OCRNode(Node):
    def __init__(self):
        super().__init__('ocr_node')
        self.bridge = CvBridge()
        self.sub = self.create_subscription(Image, '/roi/image', self.cb, 5)
        self.pub = self.create_publisher(String, '/ocr/text', 5)
        self.ocr = PaddleOCR(lang='en', use_angle_cls=True, use_gpu=True)

    def cb(self, msg: Image):
        img = self.bridge.imgmsg_to_cv2(msg, desired_encoding='bgr8')
        res = self.ocr.ocr(img, cls=True)
        texts = []
        for line in res:
            if len(line) > 1:
                txt = line[1][0]
                conf = line[1][1]
                texts.append(f"{txt} ({conf:.2f})")
        out = String()
        out.data = "\\n".join(texts)
        self.pub.publish(out)

def main(args=None):
    rclpy.init(args=args)
    node = OCRNode()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()
</pre>

          <h4>5) nova_voice — TTS & STT stubs (long)</h4>
          <pre class="code-box">
# File: ros2_ws/src/nova_voice/nova_voice/tts_node.py
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from std_msgs.msg import String
import subprocess
import os

class TTS(Node):
    def __init__(self):
        super().__init__('nova_tts')
        self.sub = self.create_subscription(String, '/tts/say', self.cb, 10)
        self.voice = os.environ.get('NOVA_TTS_VOICE', 'te')  # Telugu code for espeak
        self.get_logger().info(f'TTS voice: {self.voice}')

    def cb(self, msg: String):
        text = msg.data
        # Call espeak (ensure installed) - for better quality replace with Coqui or TTS model
        try:
            subprocess.Popen(['espeak', '-v', self.voice, text])
        except Exception as e:
            self.get_logger().error(f'TTS failed: {e}')

def main(args=None):
    rclpy.init(args=args)
    node = TTS()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()
</pre>

          <h4>6) nova_task — state machine (long)</h4>
          <pre class="code-box">
# File: ros2_ws/src/nova_task/nova_task/task_node.py
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from std_msgs.msg import String, Bool
from geometry_msgs.msg import PoseStamped
import time

class TaskNode(Node):
    def __init__(self):
        super().__init__('nova_task')
        self.get_logger().info('Task node starting')
        self.intent_sub = self.create_subscription(String, '/nlp_intent', self.cb_intent, 10)
        self.tts_pub = self.create_publisher(String, '/tts/say', 10)
        self.nav_pub = self.create_publisher(PoseStamped, '/goal_pose', 10)
        self.state = 'IDLE'
        self.current_task = None

    def cb_intent(self, msg: String):
        intent = msg.data.lower()
        self.get_logger().info(f'Received intent: {intent}')
        if 'fetch' in intent and 'water' in intent:
            self.start_fetch_water()

    def start_fetch_water(self):
        self.state = 'NAV_TO_DISPENSER'
        self.tts('నేను నీటి కోసం వెళ్తున్నాను')  # Telugu 'I am going to fetch water'
        # publish a sample pose - replace with real waypoint
        p = PoseStamped()
        p.header.frame_id = 'map'
        p.pose.position.x = 2.0
        p.pose.position.y = 1.0
        p.pose.orientation.w = 1.0
        self.nav_pub.publish(p)

    def tts(self, text):
        m = String()
        m.data = text
        self.tts_pub.publish(m)

def main(args=None):
    rclpy.init(args=args)
    node = TaskNode()
    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()
</pre>

          <div class="hr"></div>

          <h3>Firmware — STM32 motor controller & safety (complete C file long)</h3>
          <pre class="code-box">
/* File: firmware/stm32/src/main.c
 *
 * Minimal STM32 firmware skeleton for NOVA:
 * - UART bridge for commands "VEL L R"
 * - Reads quadrature encoders with timers
 * - Publishes JSON heartbeat on UART: {"enc_l":1234,"enc_r":5678,"bat_v":24.2}
 * - E-stop digital input that cuts PWM outputs
 *
 * Note: This is a skeleton for STM32 HAL-based environment (CubeMX).
 */

#include "main.h"
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdbool.h>

/* Hardware specific handles - defined in CubeMX generated files */
UART_HandleTypeDef huart1;
TIM_HandleTypeDef htim1; // encoder left
TIM_HandleTypeDef htim2; // encoder right
TIM_HandleTypeDef htim3; // PWM timer
ADC_HandleTypeDef hadc1; // battery voltage monitor

volatile int32_t enc_l = 0;
volatile int32_t enc_r = 0;
volatile bool estop = false;

char rxbuf[128];
int rxidx = 0;

void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_USART1_UART_Init(void);
static void MX_TIM1_Init(void);
static void MX_TIM2_Init(void);
static void MX_TIM3_Init(void);
static void MX_ADC1_Init(void);

int _write(int file, char *ptr, int len) {
    // retarget printf to UART
    HAL_UART_Transmit(&huart1, (uint8_t*)ptr, len, HAL_MAX_DELAY);
    return len;
}

void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim) {
    // called by SysTick or timer
}

void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin) {
    if (GPIO_Pin == GPIO_PIN_0) { // example estop pin
        estop = HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0) == GPIO_PIN_RESET;
    }
}

// minimal quadrature read (if using timer in encoder mode)
// additional overflow handling required for production
int32_t read_enc_count_enc(TIM_HandleTypeDef *htim) {
    return (int32_t)(__HAL_TIM_GET_COUNTER(htim));
}

void process_uart_line(const char *ln) {
    // simple parser for: VEL <left> <right>
    if (strncmp(ln, "VEL", 3) == 0) {
        float l, r;
        if (sscanf(ln+3, "%f %f", &l, &r) == 2) {
            // convert to PWM duty, clamp
            int pwm_l = (int)(fabs(l) * 1000.0f);
            int pwm_r = (int)(fabs(r) * 1000.0f);
            if (pwm_l > 1000) pwm_l = 1000;
            if (pwm_r > 1000) pwm_r = 1000;
            if (!estop) {
                // update PWM registers (tim3 channel 1/2)
                __HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, pwm_l);
                __HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_2, pwm_r);
            } else {
                __HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, 0);
                __HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_2, 0);
            }
        }
    } else if (strncmp(ln, "STOP", 4) == 0) {
        // immediate stop
        __HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, 0);
        __HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_2, 0);
    }
}

void uart_rx_task(void) {
    // non-blocking read - collect until newline
    uint8_t c;
    while (HAL_UART_Receive(&huart1, &c, 1, 10) == HAL_OK) {
        if (c == '\\n' || c == '\\r') {
            if (rxidx>0) {
                rxbuf[rxidx]=0;
                process_uart_line(rxbuf);
                rxidx = 0;
            }
        } else {
            if (rxidx < (int)sizeof(rxbuf)-1) rxbuf[rxidx++]=c;
        }
    }
}

int main(void) {
    HAL_Init();
    SystemClock_Config();
    MX_GPIO_Init();
    MX_USART1_UART_Init();
    MX_TIM1_Init();
    MX_TIM2_Init();
    MX_TIM3_Init();
    MX_ADC1_Init();

    // start timers in encoder mode
    HAL_TIM_Encoder_Start(&htim1, TIM_CHANNEL_ALL);
    HAL_TIM_Encoder_Start(&htim2, TIM_CHANNEL_ALL);
    HAL_TIM_PWM_Start(&htim3, TIM_CHANNEL_1);
    HAL_TIM_PWM_Start(&htim3, TIM_CHANNEL_2);

    uint32_t last_pub = HAL_GetTick();
    char out[256];

    while (1) {
        uart_rx_task();
        // update encoder counts
        enc_l = read_enc_count_enc(&htim1);
        enc_r = read_enc_count_enc(&htim2);

        // sample battery (ADC) - simple average
        HAL_ADC_Start(&hadc1);
        HAL_ADC_PollForConversion(&hadc1, 10);
        uint32_t adc = HAL_ADC_GetValue(&hadc1);
        float bat_v = (adc / 4095.0f) * 12.6f * 2.0f; // example scaling

        // every 250ms send status as JSON
        uint32_t now = HAL_GetTick();
        if (now - last_pub > 250) {
            last_pub = now;
            snprintf(out, sizeof(out), "{\\"enc_l\\":%ld,\\"enc_r\\":%ld,\\"bat_v\\":%.2f}\\n", (long)enc_l, (long)enc_r, bat_v);
            HAL_UART_Transmit(&huart1, (uint8_t*)out, strlen(out), 20);
        }
        HAL_Delay(5);
    }
}
</pre>

          <div class="hr"></div>

          <h3>Docker & Jetson Setup (long)</h3>
          <pre class="code-box">
# File: docker/jetson/Dockerfile (example)
FROM nvcr.io/nvidia/l4t-pytorch:r35.6.1-pth1.14-py3
LABEL maintainer="you@example.com"
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y \
    python3-pip git vim ffmpeg libgl1 \
    && rm -rf /var/lib/apt/lists/*
COPY requirements.jetson.txt /tmp/requirements.txt
RUN pip3 install --no-cache-dir -r /tmp/requirements.txt
# Add user to avoid running as root
RUN useradd -ms /bin/bash nova
USER nova
WORKDIR /home/nova
COPY . /home/nova/workspace
CMD ["bash", "/home/nova/workspace/docker/start_jetson.sh"]
</pre>

          <pre class="code-box">
# File: docker/requirements.jetson.txt
torch
torchvision
torchaudio
ultralytics
opencv-python-headless
pillow
paddleocr
numpy
pyserial
rclpy
colcon-common-extensions
rosdep
transformers
sentencepiece
</pre>

          <pre class="code-box">
# File: docker/start_jetson.sh
#!/bin/bash
set -e
echo "Starting NOVA container services..."
# source ros2 if installed in image
if [ -f /opt/ros/humble/setup.bash ]; then
  source /opt/ros/humble/setup.bash
fi
# build ros workspace if present
if [ -d /home/nova/workspace/ros2_ws ]; then
  cd /home/nova/workspace/ros2_ws
  colcon build || true
  source install/setup.bash || true
fi
# start bringup
ros2 launch nova_bringup nova_bringup.launch.py
</pre>

          <div class="hr"></div>

          <h3>YOLOv8 training & dataset manifest (long)</h3>
          <pre class="code-box">
# File: training/train_yolo.sh
#!/bin/bash
# Example training script - adjust dataset paths
DATASET_DIR=${1:-"./dataset"}
WEIGHTS=${2:-"yolov8n.pt"}
EPOCHS=${3:-50}
BATCH=${4:-16}
IMG_SIZE=${5:-640}
OUTDIR=${6:-"./runs/train"}

python3 - <<'PY'
from ultralytics import YOLO
import yaml, os, sys
# build data.yaml in dataset
data_yaml = {
  'train': os.path.join('$DATASET_DIR', 'images', 'train'),
  'val': os.path.join('$DATASET_DIR', 'images', 'val'),
  'nc': 3,
  'names': ['water_bottle','dispenser_panel','button']
}
with open('data.yaml','w') as f:
  yaml.dump(data_yaml, f)
print('data.yaml written')
PY

python3 -m pip install --upgrade ultralytics
ultralytics train data=data.yaml model=$WEIGHTS epochs=$EPOCHS imgsz=$IMG_SIZE batch=$BATCH project=$OUTDIR
</pre>

          <pre class="code-box">
# File: dataset/README.md
Dataset structure:
dataset/
  images/
    train/
      img001.jpg
      img002.jpg
      ...
    val/
      val001.jpg
  labels/
    train/
      img001.txt   # YOLO format: class x_center y_center width height (normalized)
    val/
      val001.txt
Manually collect varied lighting and angles. Aim 500-2000 images, balanced classes.
</pre>

          <div class="hr"></div>

          <h3>BOM — long CSV embedded</h3>
          <pre class="code-box">
# File: hardware/bom.csv
Item,Description,Qty,EstPriceINR,SupplierNotes
Jetson Orin NX 16GB,Onboard AI compute,1,60000,Check local distributor
24V LiFePO4 40Ah,Battery pack 8S with BMS,1,30000,High discharge BMS recommend
Roboclaw 2x60A,Motor driver with encoder support,1,12000,Alternatively Sabertooth
DC motors 24V 350W,Geared brushed DC w/ encoders,2,8000,2 motors for tracked base
Track kit 400mm,Complete tracked kit with sprockets,1,7000,Ensure fit with chassis
RPLIDAR A2,2D LiDAR,1,25000,Or YDLIDAR for budget
Luxonis OAK-D Pro,Depth+AI camera,1,20000,Integrates well with Jetson
STM32F446RE,Nucleo board for IO,1,2500,
ESP32 Devkit,WiFi/BLE microcontroller,1,800,
Linear Actuator 1000N,24V,100mm stroke,1,7000,
Hydraulic pump 1500N,If using hydraulics,1,15000,
Contactor 48V 100A,Main power relay,1,2500,
Anderson SB50 connectors,Power connectors,4,800,
Wiring & misc,Cables, connectors, fuses, bolts,1,5000,
TotalEstimate,, ,222900,
</pre>

          <div class="hr"></div>

          <h3>Wiring schematic (inline SVG — high-level)</h3>
          <div class="preview">
            <!-- High-level wiring SVG -->
            <svg width="100%" height="320" viewBox="0 0 1200 360" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="lg1" x1="0" x2="1"><stop offset="0" stop-color="#6ee7b7"/><stop offset="1" stop-color="#7c3aed"/></linearGradient>
              </defs>
              <rect x="8" y="8" width="1184" height="344" rx="10" fill="rgba(255,255,255,0.01)" stroke="rgba(255,255,255,0.02)"/>
              <g font-family="Verdana" font-size="12" fill="#dbeafe">
                <rect x="30" y="40" width="180" height="80" rx="8" fill="#062030" stroke="rgba(255,255,255,0.03)"/>
                <text x="40" y="64">Battery Pack</text>
                <text x="40" y="82" font-size="11" fill="#9fb0c9">24V LiFePO4</text>

                <rect x="260" y="40" width="220" height="80" rx="8" fill="#062030" stroke="rgba(255,255,255,0.03)"/>
                <text x="272" y="64">Power Distribution</text>
                <text x="272" y="82" font-size="11" fill="#9fb0c9">DC-DC 24→12 & 5V</text>

                <rect x="520" y="40" width="220" height="80" rx="8" fill="#062030" stroke="rgba(255,255,255,0.03)"/>
                <text x="532" y="64">Jetson Orin</text>
                <text x="532" y="82" font-size="11" fill="#9fb0c9">Main compute</text>

                <rect x="780" y="40" width="320" height="80" rx="8" fill="#062030" stroke="rgba(255,255,255,0.03)"/>
                <text x="792" y="64">Motor Drivers</text>
                <text x="792" y="82" font-size="11" fill="#9fb0c9">Roboclaw / Sabertooth</text>

                <!-- lines -->
                <line x1="210" y1="80" x2="260" y2="80" stroke="url(#lg1)" stroke-width="3"/>
                <line x1="480" y1="80" x2="520" y2="80" stroke="url(#lg1)" stroke-width="3"/>
                <line x1="740" y1="80" x2="780" y2="80" stroke="url(#lg1)" stroke-width="3"/>

                <!-- sensors -->
                <rect x="60" y="150" width="240" height="60" rx="8" fill="#061624" stroke="rgba(255,255,255,0.02)"/>
                <text x="72" y="176">LiDAR</text>
                <text x="72" y="192" font-size="11" fill="#9fb0c9">RPLIDAR</text>

                <rect x="340" y="150" width="220" height="60" rx="8" fill="#061624" stroke="rgba(255,255,255,0.02)"/>
                <text x="352" y="176">OAK-D</text>
                <text x="352" y="192" font-size="11" fill="#9fb0c9">Stereo + IMU</text>

                <rect x="700" y="150" width="200" height="60" rx="8" fill="#061624" stroke="rgba(255,255,255,0.02)"/>
                <text x="712" y="176">STM32</text>
                <text x="712" y="192" font-size="11" fill="#9fb0c9">Motor IO & Safety</text>

                <!-- connections -->
                <line x1="600" y1="120" x2="580" y2="150" stroke="rgba(255,255,255,0.06)" stroke-width="2" stroke-dasharray="6 4"/>
                <text x="620" y="128" fill="#9fb0c9" font-size="11">USB/Serial</text>

                <line x1="760" y1="120" x2="760" y2="150" stroke="rgba(255,255,255,0.06)" stroke-width="2" stroke-dasharray="6 4"/>

                <text x="40" y="250" font-size="12" fill="#dbeafe">Notes: E-stop hardwired to contactor; motor drivers share 24V main; Jetson powered by 24→5V DC-DC; sensor lines to USB hub or direct to Jetson.</text>
              </g>
            </svg>
          </div>

          <div class="hr"></div>

          <h3>Troubleshooting & Thermal Management (long checklist)</h3>
          <ul>
            <li>Jetson thermal throttling: install active fan + heatsink, log <code>/sys/devices/...</code> temperatures, reduce max frequency in software if needed.</li>
            <li>Motor driver overheating: ensure correct current limits, forced-air on drivers, thermal cutoff fuse as last resort.</li>
            <li>EMI: separate power & signal harnesses; use ferrite beads on USB and power lines.</li>
            <li>Odometry drift: run wheel calibration, use <code>robot_localization</code> with IMU & wheel odom fusion.</li>
            <li>STT inaccuracies: reduce command grammar to small closed set, add confirmation TTS before task execution.</li>
          </ul>
        </section>

        <!-- LONG APP-LIKE CONTROL PANEL -->
        <section class="card" style="margin-top:18px;">
          <div class="section-title"><div class="huge">Control Panel (simulated)</div><div class="small-muted">Mock UI to preview commands and logs</div></div>
          <div class="nav-tabs" role="tablist">
            <div class="tab active" data-tab="teleop">Teleop</div>
            <div class="tab" data-tab="logs">Logs</div>
            <div class="tab" data-tab="maps">Maps</div>
            <div class="tab" data-tab="models">Models</div>
          </div>

          <div id="teleop" class="preview" style="display:block">
            <h4>Teleop</h4>
            <p class="small-muted">Use the controls below to simulate /cmd_vel publishing. (This page is local-only; to hook up to ROS2, use rosbridge or ros2-web-bridge.)</p>
            <div style="display:flex;gap:12px;align-items:center;margin-bottom:10px;">
              <div>
                <label class="small-muted">Linear (m/s)</label><br>
                <input id="lin" type="range" min="-1" max="1" step="0.01" value="0" style="width:320px">
              </div>
              <div>
                <label class="small-muted">Angular (rad/s)</label><br>
                <input id="ang" type="range" min="-2" max="2" step="0.01" value="0" style="width:200px">
              </div>
              <div style="margin-left:auto">
                <button class="btn btn-primary" id="send-cmd">Send</button>
              </div>
            </div>
            <pre id="teleop-log" class="code-box">teleop log...</pre>
          </div>

          <div id="logs" class="preview" style="display:none">
            <h4>System Logs</h4>
            <pre id="sys-log" class="code-box">System log buffer will appear here (simulated)</pre>
          </div>

          <div id="maps" class="preview" style="display:none">
            <h4>Maps</h4>
            <p class="small-muted">Saved maps will be listed here. Use Nav2 to save maps to disk and drag them into this UI for preview.</p>
            <ul id="map-list">
              <li>office_map_2025-08-15.pgm</li>
            </ul>
          </div>

          <div id="models" class="preview" style="display:none">
            <h4>Models</h4>
            <p class="small-muted">Model artifacts and basic metrics</p>
            <table>
              <thead><tr><th>Model</th><th>Type</th><th>mAP</th><th>Size</th></tr></thead>
              <tbody>
                <tr><td>yolov8n-nova</td><td>yolo</td><td>0.76</td><td>14MB</td></tr>
                <tr><td>paddle-ocr-en</td><td>ocr</td><td>n/a</td><td>120MB</td></tr>
              </tbody>
            </table>
          </div>
        </section>

      </main>

      <aside>
        <div class="card">
          <h3>Quick Actions</h3>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:10px">
            <button class="btn" onclick="copyAll('ros2')">Copy ROS2 skeleton</button>
            <button class="btn" onclick="copyAll('firmware')">Copy STM32 firmware</button>
            <button class="btn" onclick="copyAll('docker')">Copy Docker files</button>
            <button class="btn" onclick="copyAll('yolo')">Copy YOLO scripts</button>
          </div>
          <div class="hr"></div>
          <h4>Project Status</h4>
          <p class="small-muted">MVP target: indoor fetch (20kg in-bay) → achieved by scaled electrical actuators & tracked base. Heavy-lift roadmap included in docs.</p>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Notes to Repo</h3>
          <ol>
            <li>Commit convention: feat/, fix/, docs/, ci/</li>
            <li>Large binary artifacts (models) stored in Git LFS</li>
            <li>Use GitHub Actions to run unit tests & build Docker image</li>
          </ol>
          <div class="hr"></div>
          <h4>Contact</h4>
          <p class="small-muted">Owner: <strong>Siddhardha</strong> (V). Update repo & push to GitHub Pages.</p>
        </div>
      </aside>
    </div>

    <div class="footer">
      <div>Generated: Aug 15, 2025 — Project NOVA single-file developer portal. Ask me to append more code blocks or to export a ZIP of all files (I will generate the content here so you can copy/paste into files).</div>
    </div>
  </div>

  <script>
  // ---------- Long JS: interactive behavior & copy helpers ----------
  (function(){
    // tabs
    document.querySelectorAll('.tab').forEach(t=>{
      t.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const name = t.getAttribute('data-tab');
        ['teleop','logs','maps','models'].forEach(id=>{
          document.getElementById(id).style.display = (id===name)?'block':'none';
        });
      });
    });

    // Teleop simulation
    const lin = document.getElementById('lin');
    const ang = document.getElementById('ang');
    const log = document.getElementById('teleop-log');
    document.getElementById('send-cmd').addEventListener('click',()=>{
      const l=lin.value, a=ang.value;
      const t = new Date().toLocaleTimeString();
      log.textContent = `[${t}] PUBLISH /cmd_vel -> linear: ${l} m/s, angular: ${a} rad/s\\n` + log.textContent;
      // Here you could integrate rosbridge websockets to actually publish
    });

    // copyAll helper - extracts sections and copies to clipboard (simulated)
    window.copyAll = function(kind){
      let text = '';
      if(kind==='ros2') {
        text = document.querySelector('pre.code-box').innerText;
      } else if(kind==='firmware') {
        // find firmware block by searching for main.c signature
        const blocks = Array.from(document.querySelectorAll('pre.code-box'));
        const block = blocks.find(b=>b.innerText.includes('firmware/stm32/src/main.c'));
        text = block?block.innerText:'Firmware not found';
      } else if(kind==='docker') {
        text = Array.from(document.querySelectorAll('pre.code-box')).map(b=>b.innerText).join('\\n\\n---\\n\\n');
      } else if(kind==='yolo') {
        text = Array.from(document.querySelectorAll('pre.code-box')).map(b=>b.innerText).join('\\n\\n---\\n\\n');
      }
      navigator.clipboard.writeText(text).then(()=>alert('Copied to clipboard (long).'), ()=>alert('Copy failed.'));
    };

    // download all button (simulate generating a zip)
    document.getElementById('download-all').addEventListener('click', async ()=>{
      alert('I cannot create binary ZIP in this HTML page, but I can generate all files as text blocks for you to copy. Use the "Copy" buttons to put data in clipboard.');
    });

    // simulated sys log filler
    const sys = document.getElementById('sys-log');
    function addSys(msg){
      sys.textContent = `[${new Date().toLocaleTimeString()}] ${msg}\\n` + sys.textContent;
    }
    addSys('System portal loaded. ROS2 skeleton ready.');

  })();
  </script>
</body>
</html>
